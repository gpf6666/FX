var T=Object.defineProperty;var d=(S,k)=>T(S,"name",{value:k,configurable:!0});import{r as g,h as V,y as o,A as e,K as m,J as E,aj as M,a4 as N,P as C,a6 as F,O as l,aC as D,z as r,Q as x}from"./vendor-Bqb8d2G-.js";import{u as J,b as y}from"./index-zIVw9yR6.js";import{A as w}from"./Avatar-BAaMKrZ8.js";import{_ as L}from"./_plugin-vue_export-helper-y4GvAF8u.js";import{E as v}from"./element-BpKrs9tq.js";const O={class:"add-friend-page"},P={class:"add-friend-content"},Q={class:"search-section"},G={class:"search-box"},H=["disabled"],W=["disabled"],X={key:0,class:"iconfont icon-loading"},Y={key:1},Z={key:0,class:"search-status"},I={key:0,class:"search-results"},ss={class:"user-list"},es={class:"user-avatar"},ts={class:"user-info"},as={class:"user-name"},ns={class:"user-username"},is={class:"user-actions"},os=["onClick","disabled"],rs={key:1,class:"friend-status"},cs={key:2,class:"request-status"},ds={key:1,class:"recommended-section"},ls={class:"user-list"},us={class:"user-avatar"},vs={class:"user-info"},_s={class:"user-name"},ps={class:"user-username"},ms={class:"user-actions"},fs=["onClick","disabled"],hs={key:1,class:"friend-status"},gs={key:2,class:"request-status"},ys={key:2,class:"requests-section"},ks={class:"user-list"},bs={class:"user-avatar"},qs={class:"user-info"},Cs={class:"user-name"},Fs={class:"user-username"},xs={class:"request-message"},ws={class:"user-actions"},Ss=["onClick","disabled"],Rs=["onClick","disabled"],$s={key:3,class:"empty-search"},As={key:4,class:"empty-state"},Us={__name:"AddFriend",setup(S){const k=D();J();const p=g(""),_=g([]),h=g([]),c=g([]),R=g(null),f=g(!1),A=d(()=>{k.back()},"goBack"),b=d(async()=>{if(!p.value.trim()){_.value=[];return}f.value=!0;try{const a=await y.get(`/api/users/search?keyword=${encodeURIComponent(p.value)}`);a.data.success&&(_.value=a.data.users.map(t=>({...t,requesting:!1})))}catch(a){console.error("搜索用户失败:",a),v.error("搜索失败")}finally{f.value=!1}},"searchUsers"),U=d(()=>{p.value.trim()?(clearTimeout(R.value),R.value=setTimeout(()=>{b()},500)):_.value=[]},"handleSearch"),$=d(async a=>{var t,s;try{const n=_.value.find(i=>i._id===a)||h.value.find(i=>i._id===a);n&&(n.requesting=!0),(await y.post("/api/users/friends/request",{receiver:a,message:"请求添加您为好友"})).data.success&&(v.success("好友请求已发送"),n&&(n.requestSent=!0,n.requesting=!1))}catch(n){(s=(t=n.response)==null?void 0:t.data)!=null&&s.message?v.error(n.response.data.message):v.error("发送好友请求失败");const u=_.value.find(i=>i._id===a)||h.value.find(i=>i._id===a);u&&(u.requesting=!1)}},"sendFriendRequest"),j=d(async a=>{var t,s;try{const n=c.value.find(i=>i._id===a);if(n&&(n.processing=!0),(await y.post(`/api/users/friends/accept/${a}`)).data.success){v.success("已接受好友请求");const i=c.value.findIndex(q=>q._id===a);i!==-1&&c.value.splice(i,1)}}catch(n){(s=(t=n.response)==null?void 0:t.data)!=null&&s.message?v.error(n.response.data.message):v.error("接受好友请求失败");const u=c.value.find(i=>i._id===a);u&&(u.processing=!1)}},"acceptFriendRequest"),z=d(async a=>{var t,s;try{const n=c.value.find(i=>i._id===a);if(n&&(n.processing=!0),(await y.post(`/api/users/friends/reject/${a}`)).data.success){v.success("已拒绝好友请求");const i=c.value.findIndex(q=>q._id===a);i!==-1&&c.value.splice(i,1)}}catch(n){(s=(t=n.response)==null?void 0:t.data)!=null&&s.message?v.error(n.response.data.message):v.error("接受好友请求失败");const u=c.value.find(i=>i._id===a);u&&(u.processing=!1)}},"rejectFriendRequest"),B=d(async()=>{try{const a=await y.get("/api/users/recommended");a.data.success&&(h.value=a.data.users.map(t=>({...t,isFriend:t.isFriend||!1,requestSent:t.requestSent||!1,requesting:!1})))}catch(a){console.error("获取推荐好友失败:",a)}},"getRecommendedUsers"),K=d(async()=>{try{const a=await y.get("/api/users/friends/requests");a.data.success&&(c.value=a.data.requests.map(t=>({...t,processing:!1})))}catch(a){console.error("获取好友请求失败:",a)}},"getFriendRequests");return V(()=>{B(),K()}),(a,t)=>(r(),o("div",O,[e("div",{class:"add-friend-header"},[e("button",{class:"back-btn",onClick:A,"aria-label":"返回"},t[1]||(t[1]=[e("i",{class:"iconfont icon-back"},null,-1)])),t[2]||(t[2]=e("h2",null,"添加好友",-1))]),e("div",P,[e("div",Q,[e("div",G,[t[3]||(t[3]=e("i",{class:"iconfont icon-search"},null,-1)),E(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),type:"text",placeholder:"搜索用户名或昵称",onInput:U,onKeyup:N(b,["enter"]),disabled:f.value},null,40,H),[[M,p.value]]),e("button",{class:"search-btn",onClick:b,disabled:f.value},[f.value?(r(),o("i",X)):(r(),o("span",Y,"搜索"))],8,W)]),f.value?(r(),o("div",Z,t[4]||(t[4]=[e("i",{class:"iconfont icon-loading"},null,-1),e("span",null,"搜索中...",-1)]))):m("",!0)]),_.value.length>0?(r(),o("div",I,[t[5]||(t[5]=e("h3",null,"搜索结果",-1)),e("div",ss,[(r(!0),o(C,null,F(_.value,s=>(r(),o("div",{key:s._id,class:"user-item"},[e("div",es,[x(w,{src:s.avatar,size:"medium"},null,8,["src"])]),e("div",ts,[e("div",as,l(s.nickname||s.username),1),e("div",ns,"@"+l(s.username),1)]),e("div",is,[!s.isFriend&&!s.requestSent?(r(),o("button",{key:0,class:"add-btn",onClick:d(n=>$(s._id),"onClick"),disabled:s.requesting},l(s.requesting?"发送中...":"添加"),9,os)):s.isFriend?(r(),o("span",rs,"已是好友")):s.requestSent?(r(),o("span",cs,"请求已发送")):m("",!0)])]))),128))])])):m("",!0),!p.value&&h.value.length>0?(r(),o("div",ds,[t[6]||(t[6]=e("h3",null,"推荐好友",-1)),e("div",ls,[(r(!0),o(C,null,F(h.value,s=>(r(),o("div",{key:s._id,class:"user-item"},[e("div",us,[x(w,{src:s.avatar,size:"medium"},null,8,["src"])]),e("div",vs,[e("div",_s,l(s.nickname||s.username),1),e("div",ps,"@"+l(s.username),1)]),e("div",ms,[!s.isFriend&&!s.requestSent?(r(),o("button",{key:0,class:"add-btn",onClick:d(n=>$(s._id),"onClick"),disabled:s.requesting},l(s.requesting?"发送中...":"添加"),9,fs)):s.isFriend?(r(),o("span",hs,"已是好友")):s.requestSent?(r(),o("span",gs,"请求已发送")):m("",!0)])]))),128))])])):m("",!0),c.value.length>0?(r(),o("div",ys,[e("h3",null,"好友请求 ("+l(c.value.length)+")",1),e("div",ks,[(r(!0),o(C,null,F(c.value,s=>(r(),o("div",{key:s._id,class:"user-item"},[e("div",bs,[x(w,{src:s.sender.avatar,size:"medium"},null,8,["src"])]),e("div",qs,[e("div",Cs,l(s.sender.nickname||s.sender.username),1),e("div",Fs,"@"+l(s.sender.username),1),e("div",xs,l(s.message||"请求添加您为好友"),1)]),e("div",ws,[e("button",{class:"accept-btn",onClick:d(n=>j(s._id),"onClick"),disabled:s.processing},l(s.processing?"处理中...":"接受"),9,Ss),e("button",{class:"reject-btn",onClick:d(n=>z(s._id),"onClick"),disabled:s.processing},l(s.processing?"处理中...":"拒绝"),9,Rs)])]))),128))])])):m("",!0),p.value&&!f.value&&_.value.length===0?(r(),o("div",$s,t[7]||(t[7]=[e("div",{class:"empty-icon"},[e("i",{class:"iconfont icon-search"})],-1),e("p",null,"未找到匹配的用户",-1),e("p",{class:"search-tip"},"尝试搜索用户名或昵称",-1)]))):m("",!0),!p.value&&_.value.length===0&&h.value.length===0&&c.value.length===0?(r(),o("div",As,t[8]||(t[8]=[e("div",{class:"empty-icon"},[e("i",{class:"iconfont icon-user"})],-1),e("p",null,"搜索用户添加好友",-1)]))):m("",!0)])]))}},Es=L(Us,[["__scopeId","data-v-69b5e4d2"]]);export{Es as default};
