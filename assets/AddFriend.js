var j=Object.defineProperty;var d=(S,k)=>j(S,"name",{value:k,configurable:!0});import{u as E,r as g,n as K,c as o,b as e,p as f,q as M,v as N,y as D,F,s as C,t as l,z as y,h as L,E as v,o as c,e as x}from"./index.js";import{A as w}from"./Avatar.js";import{_ as G}from"./_plugin-vue_export-helper.js";const H={class:"add-friend-page"},J={class:"add-friend-content"},O={class:"search-section"},P={class:"search-box"},Q=["disabled"],W=["disabled"],X={key:0,class:"iconfont icon-loading"},Y={key:1},Z={key:0,class:"search-status"},I={key:0,class:"search-results"},ss={class:"user-list"},es={class:"user-avatar"},ts={class:"user-info"},ns={class:"user-name"},as={class:"user-username"},is={class:"user-actions"},os=["onClick","disabled"],cs={key:1,class:"friend-status"},rs={key:2,class:"request-status"},ds={key:1,class:"recommended-section"},ls={class:"user-list"},us={class:"user-avatar"},vs={class:"user-info"},_s={class:"user-name"},ps={class:"user-username"},fs={class:"user-actions"},ms=["onClick","disabled"],hs={key:1,class:"friend-status"},gs={key:2,class:"request-status"},ys={key:2,class:"requests-section"},ks={class:"user-list"},bs={class:"user-avatar"},qs={class:"user-info"},Fs={class:"user-name"},Cs={class:"user-username"},xs={class:"request-message"},ws={class:"user-actions"},Ss=["onClick","disabled"],Rs=["onClick","disabled"],$s={key:3,class:"empty-search"},As={key:4,class:"empty-state"},Us={__name:"AddFriend",setup(S){const k=L();E();const p=g(""),_=g([]),h=g([]),r=g([]),R=g(null),m=g(!1),A=d(()=>{k.back()},"goBack"),b=d(async()=>{if(!p.value.trim()){_.value=[];return}m.value=!0;try{const n=await y.get(`/api/users/search?keyword=${encodeURIComponent(p.value)}`);n.data.success&&(_.value=n.data.users.map(t=>({...t,requesting:!1})))}catch(n){console.error("搜索用户失败:",n),v.error("搜索失败")}finally{m.value=!1}},"searchUsers"),U=d(()=>{p.value.trim()?(clearTimeout(R.value),R.value=setTimeout(()=>{b()},500)):_.value=[]},"handleSearch"),$=d(async n=>{var t,s;try{const a=_.value.find(i=>i._id===n)||h.value.find(i=>i._id===n);a&&(a.requesting=!0),(await y.post("/api/users/friends/request",{receiver:n,message:"请求添加您为好友"})).data.success&&(v.success("好友请求已发送"),a&&(a.requestSent=!0,a.requesting=!1))}catch(a){(s=(t=a.response)==null?void 0:t.data)!=null&&s.message?v.error(a.response.data.message):v.error("发送好友请求失败");const u=_.value.find(i=>i._id===n)||h.value.find(i=>i._id===n);u&&(u.requesting=!1)}},"sendFriendRequest"),z=d(async n=>{var t,s;try{const a=r.value.find(i=>i._id===n);if(a&&(a.processing=!0),(await y.post(`/api/users/friends/accept/${n}`)).data.success){v.success("已接受好友请求");const i=r.value.findIndex(q=>q._id===n);i!==-1&&r.value.splice(i,1)}}catch(a){(s=(t=a.response)==null?void 0:t.data)!=null&&s.message?v.error(a.response.data.message):v.error("接受好友请求失败");const u=r.value.find(i=>i._id===n);u&&(u.processing=!1)}},"acceptFriendRequest"),B=d(async n=>{var t,s;try{const a=r.value.find(i=>i._id===n);if(a&&(a.processing=!0),(await y.post(`/api/users/friends/reject/${n}`)).data.success){v.success("已拒绝好友请求");const i=r.value.findIndex(q=>q._id===n);i!==-1&&r.value.splice(i,1)}}catch(a){(s=(t=a.response)==null?void 0:t.data)!=null&&s.message?v.error(a.response.data.message):v.error("接受好友请求失败");const u=r.value.find(i=>i._id===n);u&&(u.processing=!1)}},"rejectFriendRequest"),T=d(async()=>{try{const n=await y.get("/api/users/recommended");n.data.success&&(h.value=n.data.users.map(t=>({...t,isFriend:t.isFriend||!1,requestSent:t.requestSent||!1,requesting:!1})))}catch(n){console.error("获取推荐好友失败:",n)}},"getRecommendedUsers"),V=d(async()=>{try{const n=await y.get("/api/users/friends/requests");n.data.success&&(r.value=n.data.requests.map(t=>({...t,processing:!1})))}catch(n){console.error("获取好友请求失败:",n)}},"getFriendRequests");return K(()=>{T(),V()}),(n,t)=>(c(),o("div",H,[e("div",{class:"add-friend-header"},[e("button",{class:"back-btn",onClick:A,"aria-label":"返回"},t[1]||(t[1]=[e("i",{class:"iconfont icon-back"},null,-1)])),t[2]||(t[2]=e("h2",null,"添加好友",-1))]),e("div",J,[e("div",O,[e("div",P,[t[3]||(t[3]=e("i",{class:"iconfont icon-search"},null,-1)),M(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),type:"text",placeholder:"搜索用户名或昵称",onInput:U,onKeyup:D(b,["enter"]),disabled:m.value},null,40,Q),[[N,p.value]]),e("button",{class:"search-btn",onClick:b,disabled:m.value},[m.value?(c(),o("i",X)):(c(),o("span",Y,"搜索"))],8,W)]),m.value?(c(),o("div",Z,t[4]||(t[4]=[e("i",{class:"iconfont icon-loading"},null,-1),e("span",null,"搜索中...",-1)]))):f("",!0)]),_.value.length>0?(c(),o("div",I,[t[5]||(t[5]=e("h3",null,"搜索结果",-1)),e("div",ss,[(c(!0),o(F,null,C(_.value,s=>(c(),o("div",{key:s._id,class:"user-item"},[e("div",es,[x(w,{src:s.avatar,size:"medium"},null,8,["src"])]),e("div",ts,[e("div",ns,l(s.nickname||s.username),1),e("div",as,"@"+l(s.username),1)]),e("div",is,[!s.isFriend&&!s.requestSent?(c(),o("button",{key:0,class:"add-btn",onClick:d(a=>$(s._id),"onClick"),disabled:s.requesting},l(s.requesting?"发送中...":"添加"),9,os)):s.isFriend?(c(),o("span",cs,"已是好友")):s.requestSent?(c(),o("span",rs,"请求已发送")):f("",!0)])]))),128))])])):f("",!0),!p.value&&h.value.length>0?(c(),o("div",ds,[t[6]||(t[6]=e("h3",null,"推荐好友",-1)),e("div",ls,[(c(!0),o(F,null,C(h.value,s=>(c(),o("div",{key:s._id,class:"user-item"},[e("div",us,[x(w,{src:s.avatar,size:"medium"},null,8,["src"])]),e("div",vs,[e("div",_s,l(s.nickname||s.username),1),e("div",ps,"@"+l(s.username),1)]),e("div",fs,[!s.isFriend&&!s.requestSent?(c(),o("button",{key:0,class:"add-btn",onClick:d(a=>$(s._id),"onClick"),disabled:s.requesting},l(s.requesting?"发送中...":"添加"),9,ms)):s.isFriend?(c(),o("span",hs,"已是好友")):s.requestSent?(c(),o("span",gs,"请求已发送")):f("",!0)])]))),128))])])):f("",!0),r.value.length>0?(c(),o("div",ys,[e("h3",null,"好友请求 ("+l(r.value.length)+")",1),e("div",ks,[(c(!0),o(F,null,C(r.value,s=>(c(),o("div",{key:s._id,class:"user-item"},[e("div",bs,[x(w,{src:s.sender.avatar,size:"medium"},null,8,["src"])]),e("div",qs,[e("div",Fs,l(s.sender.nickname||s.sender.username),1),e("div",Cs,"@"+l(s.sender.username),1),e("div",xs,l(s.message||"请求添加您为好友"),1)]),e("div",ws,[e("button",{class:"accept-btn",onClick:d(a=>z(s._id),"onClick"),disabled:s.processing},l(s.processing?"处理中...":"接受"),9,Ss),e("button",{class:"reject-btn",onClick:d(a=>B(s._id),"onClick"),disabled:s.processing},l(s.processing?"处理中...":"拒绝"),9,Rs)])]))),128))])])):f("",!0),p.value&&!m.value&&_.value.length===0?(c(),o("div",$s,t[7]||(t[7]=[e("div",{class:"empty-icon"},[e("i",{class:"iconfont icon-search"})],-1),e("p",null,"未找到匹配的用户",-1),e("p",{class:"search-tip"},"尝试搜索用户名或昵称",-1)]))):f("",!0),!p.value&&_.value.length===0&&h.value.length===0&&r.value.length===0?(c(),o("div",As,t[8]||(t[8]=[e("div",{class:"empty-icon"},[e("i",{class:"iconfont icon-user"})],-1),e("p",null,"搜索用户添加好友",-1)]))):f("",!0)])]))}},js=G(Us,[["__scopeId","data-v-08017f8f"]]);export{js as default};
