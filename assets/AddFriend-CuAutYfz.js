var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,t=(s,a,n)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[a]=n,r=(e,s)=>{for(var a in s||(s={}))i.call(s,a)&&t(e,a,s[a]);if(n)for(var a of n(s))l.call(s,a)&&t(e,a,s[a]);return e},c=(e,n)=>s(e,a(n)),u=(e,s,a)=>new Promise(((n,i)=>{var l=e=>{try{r(a.next(e))}catch(s){i(s)}},t=e=>{try{r(a.throw(e))}catch(s){i(s)}},r=e=>e.done?n(e.value):Promise.resolve(e.value).then(l,t);r((a=a.apply(e,s)).next())}));import{r as d,h as o,y as v,A as p,K as m,J as f,aj as y,a4 as g,P as h,a6 as b,O as k,aC as _,z as q,Q as j}from"./vendor-BU-zYVMe.js";import{u as C,b as O}from"./index-zPCyQuwE.js";import{A as x}from"./Avatar-BggJlZXq.js";import{_ as P}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{E as S}from"./element-LGSq3epL.js";const w={class:"add-friend-page"},F={class:"add-friend-content"},I={class:"search-section"},z={class:"search-box"},A=["disabled"],$=["disabled"],E={key:0,class:"iconfont icon-loading"},K={key:1},T={key:0,class:"search-status"},U={key:0,class:"search-results"},D={class:"user-list"},J={class:"user-avatar"},Q={class:"user-info"},R={class:"user-name"},V={class:"user-username"},B={class:"user-actions"},G=["onClick","disabled"],H={key:1,class:"friend-status"},L={key:2,class:"request-status"},M={key:1,class:"recommended-section"},N={class:"user-list"},W={class:"user-avatar"},X={class:"user-info"},Y={class:"user-name"},Z={class:"user-username"},ee={class:"user-actions"},se=["onClick","disabled"],ae={key:1,class:"friend-status"},ne={key:2,class:"request-status"},ie={key:2,class:"requests-section"},le={class:"user-list"},te={class:"user-avatar"},re={class:"user-info"},ce={class:"user-name"},ue={class:"user-username"},de={class:"request-message"},oe={class:"user-actions"},ve=["onClick","disabled"],pe=["onClick","disabled"],me={key:3,class:"empty-search"},fe={key:4,class:"empty-state"},ye=P({__name:"AddFriend",setup(e){const s=_();C();const a=d(""),n=d([]),i=d([]),l=d([]),t=d(null),P=d(!1),ye=()=>{s.back()},ge=()=>u(this,null,(function*(){if(a.value.trim()){P.value=!0;try{const e=yield O.get(`/api/users/search?keyword=${encodeURIComponent(a.value)}`);e.data.success&&(n.value=e.data.users.map((e=>c(r({},e),{requesting:!1}))))}catch(e){S.error("搜索失败")}finally{P.value=!1}}else n.value=[]})),he=()=>{a.value.trim()?(clearTimeout(t.value),t.value=setTimeout((()=>{ge()}),500)):n.value=[]},be=e=>u(this,null,(function*(){var s,a;try{const s=n.value.find((s=>s._id===e))||i.value.find((s=>s._id===e));s&&(s.requesting=!0);(yield O.post("/api/users/friends/request",{receiver:e,message:"请求添加您为好友"})).data.success&&(S.success("好友请求已发送"),s&&(s.requestSent=!0,s.requesting=!1))}catch(l){(null==(a=null==(s=l.response)?void 0:s.data)?void 0:a.message)?S.error(l.response.data.message):S.error("发送好友请求失败");const t=n.value.find((s=>s._id===e))||i.value.find((s=>s._id===e));t&&(t.requesting=!1)}})),ke=e=>u(this,null,(function*(){var s,a;try{const s=l.value.find((s=>s._id===e));s&&(s.processing=!0);if((yield O.post(`/api/users/friends/accept/${e}`)).data.success){S.success("已接受好友请求");const s=l.value.findIndex((s=>s._id===e));-1!==s&&l.value.splice(s,1)}}catch(n){(null==(a=null==(s=n.response)?void 0:s.data)?void 0:a.message)?S.error(n.response.data.message):S.error("接受好友请求失败");const i=l.value.find((s=>s._id===e));i&&(i.processing=!1)}})),_e=e=>u(this,null,(function*(){var s,a;try{const s=l.value.find((s=>s._id===e));s&&(s.processing=!0);if((yield O.post(`/api/users/friends/reject/${e}`)).data.success){S.success("已拒绝好友请求");const s=l.value.findIndex((s=>s._id===e));-1!==s&&l.value.splice(s,1)}}catch(n){(null==(a=null==(s=n.response)?void 0:s.data)?void 0:a.message)?S.error(n.response.data.message):S.error("接受好友请求失败");const i=l.value.find((s=>s._id===e));i&&(i.processing=!1)}})),qe=()=>u(this,null,(function*(){try{const e=yield O.get("/api/users/recommended");e.data.success&&(i.value=e.data.users.map((e=>c(r({},e),{isFriend:e.isFriend||!1,requestSent:e.requestSent||!1,requesting:!1}))))}catch(e){}})),je=()=>u(this,null,(function*(){try{const e=yield O.get("/api/users/friends/requests");e.data.success&&(l.value=e.data.requests.map((e=>c(r({},e),{processing:!1}))))}catch(e){}}));return o((()=>{qe(),je()})),(e,s)=>(q(),v("div",w,[p("div",{class:"add-friend-header"},[p("button",{class:"back-btn",onClick:ye,"aria-label":"返回"},s[1]||(s[1]=[p("i",{class:"iconfont icon-back"},null,-1)])),s[2]||(s[2]=p("h2",null,"添加好友",-1))]),p("div",F,[p("div",I,[p("div",z,[s[3]||(s[3]=p("i",{class:"iconfont icon-search"},null,-1)),f(p("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>a.value=e),type:"text",placeholder:"搜索用户名或昵称",onInput:he,onKeyup:g(ge,["enter"]),disabled:P.value},null,40,A),[[y,a.value]]),p("button",{class:"search-btn",onClick:ge,disabled:P.value},[P.value?(q(),v("i",E)):(q(),v("span",K,"搜索"))],8,$)]),P.value?(q(),v("div",T,s[4]||(s[4]=[p("i",{class:"iconfont icon-loading"},null,-1),p("span",null,"搜索中...",-1)]))):m("",!0)]),n.value.length>0?(q(),v("div",U,[s[5]||(s[5]=p("h3",null,"搜索结果",-1)),p("div",D,[(q(!0),v(h,null,b(n.value,(e=>(q(),v("div",{key:e._id,class:"user-item"},[p("div",J,[j(x,{src:e.avatar,size:"medium"},null,8,["src"])]),p("div",Q,[p("div",R,k(e.nickname||e.username),1),p("div",V,"@"+k(e.username),1)]),p("div",B,[e.isFriend||e.requestSent?e.isFriend?(q(),v("span",H,"已是好友")):e.requestSent?(q(),v("span",L,"请求已发送")):m("",!0):(q(),v("button",{key:0,class:"add-btn",onClick:s=>be(e._id),disabled:e.requesting},k(e.requesting?"发送中...":"添加"),9,G))])])))),128))])])):m("",!0),!a.value&&i.value.length>0?(q(),v("div",M,[s[6]||(s[6]=p("h3",null,"推荐好友",-1)),p("div",N,[(q(!0),v(h,null,b(i.value,(e=>(q(),v("div",{key:e._id,class:"user-item"},[p("div",W,[j(x,{src:e.avatar,size:"medium"},null,8,["src"])]),p("div",X,[p("div",Y,k(e.nickname||e.username),1),p("div",Z,"@"+k(e.username),1)]),p("div",ee,[e.isFriend||e.requestSent?e.isFriend?(q(),v("span",ae,"已是好友")):e.requestSent?(q(),v("span",ne,"请求已发送")):m("",!0):(q(),v("button",{key:0,class:"add-btn",onClick:s=>be(e._id),disabled:e.requesting},k(e.requesting?"发送中...":"添加"),9,se))])])))),128))])])):m("",!0),l.value.length>0?(q(),v("div",ie,[p("h3",null,"好友请求 ("+k(l.value.length)+")",1),p("div",le,[(q(!0),v(h,null,b(l.value,(e=>(q(),v("div",{key:e._id,class:"user-item"},[p("div",te,[j(x,{src:e.sender.avatar,size:"medium"},null,8,["src"])]),p("div",re,[p("div",ce,k(e.sender.nickname||e.sender.username),1),p("div",ue,"@"+k(e.sender.username),1),p("div",de,k(e.message||"请求添加您为好友"),1)]),p("div",oe,[p("button",{class:"accept-btn",onClick:s=>ke(e._id),disabled:e.processing},k(e.processing?"处理中...":"接受"),9,ve),p("button",{class:"reject-btn",onClick:s=>_e(e._id),disabled:e.processing},k(e.processing?"处理中...":"拒绝"),9,pe)])])))),128))])])):m("",!0),a.value&&!P.value&&0===n.value.length?(q(),v("div",me,s[7]||(s[7]=[p("div",{class:"empty-icon"},[p("i",{class:"iconfont icon-search"})],-1),p("p",null,"未找到匹配的用户",-1),p("p",{class:"search-tip"},"尝试搜索用户名或昵称",-1)]))):m("",!0),a.value||0!==n.value.length||0!==i.value.length||0!==l.value.length?m("",!0):(q(),v("div",fe,s[8]||(s[8]=[p("div",{class:"empty-icon"},[p("i",{class:"iconfont icon-user"})],-1),p("p",null,"搜索用户添加好友",-1)])))])]))}},[["__scopeId","data-v-69b5e4d2"]]);export{ye as default};
