import{u as T,r as h,n as V,c as o,b as e,p,q as j,v as E,y as K,F as b,s as q,t as d,z as g,h as M,E as u,o as c,e as F}from"./index-CkSvKw9W.js";import{A as C}from"./Avatar-CBlQNIj8.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";const D={class:"add-friend-page"},L={class:"add-friend-content"},G={class:"search-section"},H={class:"search-box"},J=["disabled"],O=["disabled"],P={key:0,class:"iconfont icon-loading"},Q={key:1},W={key:0,class:"search-status"},X={key:0,class:"search-results"},Y={class:"user-list"},Z={class:"user-avatar"},I={class:"user-info"},ss={class:"user-name"},es={class:"user-username"},ts={class:"user-actions"},ns=["onClick","disabled"],as={key:1,class:"friend-status"},is={key:2,class:"request-status"},os={key:1,class:"recommended-section"},cs={class:"user-list"},rs={class:"user-avatar"},ds={class:"user-info"},ls={class:"user-name"},us={class:"user-username"},vs={class:"user-actions"},_s=["onClick","disabled"],ps={key:1,class:"friend-status"},fs={key:2,class:"request-status"},ms={key:2,class:"requests-section"},hs={class:"user-list"},gs={class:"user-avatar"},ys={class:"user-info"},ks={class:"user-name"},bs={class:"user-username"},qs={class:"request-message"},Fs={class:"user-actions"},Cs=["onClick","disabled"],xs=["onClick","disabled"],ws={key:3,class:"empty-search"},Ss={key:4,class:"empty-state"},Rs={__name:"AddFriend",setup($s){const S=M();T();const _=h(""),v=h([]),m=h([]),r=h([]),x=h(null),f=h(!1),R=()=>{S.back()},y=async()=>{if(!_.value.trim()){v.value=[];return}f.value=!0;try{const n=await g.get(`/api/users/search?keyword=${encodeURIComponent(_.value)}`);n.data.success&&(v.value=n.data.users.map(t=>({...t,requesting:!1})))}catch(n){console.error("搜索用户失败:",n),u.error("搜索失败")}finally{f.value=!1}},$=()=>{_.value.trim()?(clearTimeout(x.value),x.value=setTimeout(()=>{y()},500)):v.value=[]},w=async n=>{var t,s;try{const a=v.value.find(i=>i._id===n)||m.value.find(i=>i._id===n);a&&(a.requesting=!0),(await g.post("/api/users/friends/request",{receiver:n,message:"请求添加您为好友"})).data.success&&(u.success("好友请求已发送"),a&&(a.requestSent=!0,a.requesting=!1))}catch(a){(s=(t=a.response)==null?void 0:t.data)!=null&&s.message?u.error(a.response.data.message):u.error("发送好友请求失败");const l=v.value.find(i=>i._id===n)||m.value.find(i=>i._id===n);l&&(l.requesting=!1)}},A=async n=>{var t,s;try{const a=r.value.find(i=>i._id===n);if(a&&(a.processing=!0),(await g.post(`/api/users/friends/accept/${n}`)).data.success){u.success("已接受好友请求");const i=r.value.findIndex(k=>k._id===n);i!==-1&&r.value.splice(i,1)}}catch(a){(s=(t=a.response)==null?void 0:t.data)!=null&&s.message?u.error(a.response.data.message):u.error("接受好友请求失败");const l=r.value.find(i=>i._id===n);l&&(l.processing=!1)}},U=async n=>{var t,s;try{const a=r.value.find(i=>i._id===n);if(a&&(a.processing=!0),(await g.post(`/api/users/friends/reject/${n}`)).data.success){u.success("已拒绝好友请求");const i=r.value.findIndex(k=>k._id===n);i!==-1&&r.value.splice(i,1)}}catch(a){(s=(t=a.response)==null?void 0:t.data)!=null&&s.message?u.error(a.response.data.message):u.error("接受好友请求失败");const l=r.value.find(i=>i._id===n);l&&(l.processing=!1)}},z=async()=>{try{const n=await g.get("/api/users/recommended");n.data.success&&(m.value=n.data.users.map(t=>({...t,isFriend:t.isFriend||!1,requestSent:t.requestSent||!1,requesting:!1})))}catch(n){console.error("获取推荐好友失败:",n)}},B=async()=>{try{const n=await g.get("/api/users/friends/requests");n.data.success&&(r.value=n.data.requests.map(t=>({...t,processing:!1})))}catch(n){console.error("获取好友请求失败:",n)}};return V(()=>{z(),B()}),(n,t)=>(c(),o("div",D,[e("div",{class:"add-friend-header"},[e("button",{class:"back-btn",onClick:R,"aria-label":"返回"},t[1]||(t[1]=[e("i",{class:"iconfont icon-back"},null,-1)])),t[2]||(t[2]=e("h2",null,"添加好友",-1))]),e("div",L,[e("div",G,[e("div",H,[t[3]||(t[3]=e("i",{class:"iconfont icon-search"},null,-1)),j(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),type:"text",placeholder:"搜索用户名或昵称",onInput:$,onKeyup:K(y,["enter"]),disabled:f.value},null,40,J),[[E,_.value]]),e("button",{class:"search-btn",onClick:y,disabled:f.value},[f.value?(c(),o("i",P)):(c(),o("span",Q,"搜索"))],8,O)]),f.value?(c(),o("div",W,t[4]||(t[4]=[e("i",{class:"iconfont icon-loading"},null,-1),e("span",null,"搜索中...",-1)]))):p("",!0)]),v.value.length>0?(c(),o("div",X,[t[5]||(t[5]=e("h3",null,"搜索结果",-1)),e("div",Y,[(c(!0),o(b,null,q(v.value,s=>(c(),o("div",{key:s._id,class:"user-item"},[e("div",Z,[F(C,{src:s.avatar,size:"medium"},null,8,["src"])]),e("div",I,[e("div",ss,d(s.nickname||s.username),1),e("div",es,"@"+d(s.username),1)]),e("div",ts,[!s.isFriend&&!s.requestSent?(c(),o("button",{key:0,class:"add-btn",onClick:a=>w(s._id),disabled:s.requesting},d(s.requesting?"发送中...":"添加"),9,ns)):s.isFriend?(c(),o("span",as,"已是好友")):s.requestSent?(c(),o("span",is,"请求已发送")):p("",!0)])]))),128))])])):p("",!0),!_.value&&m.value.length>0?(c(),o("div",os,[t[6]||(t[6]=e("h3",null,"推荐好友",-1)),e("div",cs,[(c(!0),o(b,null,q(m.value,s=>(c(),o("div",{key:s._id,class:"user-item"},[e("div",rs,[F(C,{src:s.avatar,size:"medium"},null,8,["src"])]),e("div",ds,[e("div",ls,d(s.nickname||s.username),1),e("div",us,"@"+d(s.username),1)]),e("div",vs,[!s.isFriend&&!s.requestSent?(c(),o("button",{key:0,class:"add-btn",onClick:a=>w(s._id),disabled:s.requesting},d(s.requesting?"发送中...":"添加"),9,_s)):s.isFriend?(c(),o("span",ps,"已是好友")):s.requestSent?(c(),o("span",fs,"请求已发送")):p("",!0)])]))),128))])])):p("",!0),r.value.length>0?(c(),o("div",ms,[e("h3",null,"好友请求 ("+d(r.value.length)+")",1),e("div",hs,[(c(!0),o(b,null,q(r.value,s=>(c(),o("div",{key:s._id,class:"user-item"},[e("div",gs,[F(C,{src:s.sender.avatar,size:"medium"},null,8,["src"])]),e("div",ys,[e("div",ks,d(s.sender.nickname||s.sender.username),1),e("div",bs,"@"+d(s.sender.username),1),e("div",qs,d(s.message||"请求添加您为好友"),1)]),e("div",Fs,[e("button",{class:"accept-btn",onClick:a=>A(s._id),disabled:s.processing},d(s.processing?"处理中...":"接受"),9,Cs),e("button",{class:"reject-btn",onClick:a=>U(s._id),disabled:s.processing},d(s.processing?"处理中...":"拒绝"),9,xs)])]))),128))])])):p("",!0),_.value&&!f.value&&v.value.length===0?(c(),o("div",ws,t[7]||(t[7]=[e("div",{class:"empty-icon"},[e("i",{class:"iconfont icon-search"})],-1),e("p",null,"未找到匹配的用户",-1),e("p",{class:"search-tip"},"尝试搜索用户名或昵称",-1)]))):p("",!0),!_.value&&v.value.length===0&&m.value.length===0&&r.value.length===0?(c(),o("div",Ss,t[8]||(t[8]=[e("div",{class:"empty-icon"},[e("i",{class:"iconfont icon-user"})],-1),e("p",null,"搜索用户添加好友",-1)]))):p("",!0)])]))}},Bs=N(Rs,[["__scopeId","data-v-69b5e4d2"]]);export{Bs as default};
