import{r as h,h as B,y as o,A as e,K as p,J as K,aj as T,a4 as V,P as b,a6 as q,O as d,aC as E,z as r,Q as C}from"./chat-vendor-BrOh9MUQ.js";import{u as M,b as g}from"./chat-index-Dt5A4Wk2.js";import{A as F}from"./chat-Avatar-D-uQkRWk.js";import{_ as N}from"./chat-_plugin-vue_export-helper-DlAUqK2U.js";import{E as u}from"./chat-element-C03ZGswg.js";const D={class:"add-friend-page"},J={class:"add-friend-content"},L={class:"search-section"},O={class:"search-box"},P=["disabled"],Q=["disabled"],G={key:0,class:"iconfont icon-loading"},H={key:1},W={key:0,class:"search-status"},X={key:0,class:"search-results"},Y={class:"user-list"},Z={class:"user-avatar"},I={class:"user-info"},ss={class:"user-name"},es={class:"user-username"},ts={class:"user-actions"},as=["onClick","disabled"],ns={key:1,class:"friend-status"},is={key:2,class:"request-status"},os={key:1,class:"recommended-section"},rs={class:"user-list"},cs={class:"user-avatar"},ds={class:"user-info"},ls={class:"user-name"},us={class:"user-username"},vs={class:"user-actions"},_s=["onClick","disabled"],ps={key:1,class:"friend-status"},ms={key:2,class:"request-status"},fs={key:2,class:"requests-section"},hs={class:"user-list"},gs={class:"user-avatar"},ys={class:"user-info"},ks={class:"user-name"},bs={class:"user-username"},qs={class:"request-message"},Cs={class:"user-actions"},Fs=["onClick","disabled"],xs=["onClick","disabled"],ws={key:3,class:"empty-search"},Ss={key:4,class:"empty-state"},Rs={__name:"AddFriend",setup($s){const S=E();M();const _=h(""),v=h([]),f=h([]),c=h([]),x=h(null),m=h(!1),R=()=>{S.back()},y=async()=>{if(!_.value.trim()){v.value=[];return}m.value=!0;try{const a=await g.get(`/api/users/search?keyword=${encodeURIComponent(_.value)}`);a.data.success&&(v.value=a.data.users.map(t=>({...t,requesting:!1})))}catch(a){console.error("搜索用户失败:",a),u.error("搜索失败")}finally{m.value=!1}},$=()=>{_.value.trim()?(clearTimeout(x.value),x.value=setTimeout(()=>{y()},500)):v.value=[]},w=async a=>{var t,s;try{const n=v.value.find(i=>i._id===a)||f.value.find(i=>i._id===a);n&&(n.requesting=!0),(await g.post("/api/users/friends/request",{receiver:a,message:"请求添加您为好友"})).data.success&&(u.success("好友请求已发送"),n&&(n.requestSent=!0,n.requesting=!1))}catch(n){(s=(t=n.response)==null?void 0:t.data)!=null&&s.message?u.error(n.response.data.message):u.error("发送好友请求失败");const l=v.value.find(i=>i._id===a)||f.value.find(i=>i._id===a);l&&(l.requesting=!1)}},A=async a=>{var t,s;try{const n=c.value.find(i=>i._id===a);if(n&&(n.processing=!0),(await g.post(`/api/users/friends/accept/${a}`)).data.success){u.success("已接受好友请求");const i=c.value.findIndex(k=>k._id===a);i!==-1&&c.value.splice(i,1)}}catch(n){(s=(t=n.response)==null?void 0:t.data)!=null&&s.message?u.error(n.response.data.message):u.error("接受好友请求失败");const l=c.value.find(i=>i._id===a);l&&(l.processing=!1)}},U=async a=>{var t,s;try{const n=c.value.find(i=>i._id===a);if(n&&(n.processing=!0),(await g.post(`/api/users/friends/reject/${a}`)).data.success){u.success("已拒绝好友请求");const i=c.value.findIndex(k=>k._id===a);i!==-1&&c.value.splice(i,1)}}catch(n){(s=(t=n.response)==null?void 0:t.data)!=null&&s.message?u.error(n.response.data.message):u.error("接受好友请求失败");const l=c.value.find(i=>i._id===a);l&&(l.processing=!1)}},j=async()=>{try{const a=await g.get("/api/users/recommended");a.data.success&&(f.value=a.data.users.map(t=>({...t,isFriend:t.isFriend||!1,requestSent:t.requestSent||!1,requesting:!1})))}catch(a){console.error("获取推荐好友失败:",a)}},z=async()=>{try{const a=await g.get("/api/users/friends/requests");a.data.success&&(c.value=a.data.requests.map(t=>({...t,processing:!1})))}catch(a){console.error("获取好友请求失败:",a)}};return B(()=>{j(),z()}),(a,t)=>(r(),o("div",D,[e("div",{class:"add-friend-header"},[e("button",{class:"back-btn",onClick:R,"aria-label":"返回"},t[1]||(t[1]=[e("i",{class:"iconfont icon-back"},null,-1)])),t[2]||(t[2]=e("h2",null,"添加好友",-1))]),e("div",J,[e("div",L,[e("div",O,[t[3]||(t[3]=e("i",{class:"iconfont icon-search"},null,-1)),K(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),type:"text",placeholder:"搜索用户名或昵称",onInput:$,onKeyup:V(y,["enter"]),disabled:m.value},null,40,P),[[T,_.value]]),e("button",{class:"search-btn",onClick:y,disabled:m.value},[m.value?(r(),o("i",G)):(r(),o("span",H,"搜索"))],8,Q)]),m.value?(r(),o("div",W,t[4]||(t[4]=[e("i",{class:"iconfont icon-loading"},null,-1),e("span",null,"搜索中...",-1)]))):p("",!0)]),v.value.length>0?(r(),o("div",X,[t[5]||(t[5]=e("h3",null,"搜索结果",-1)),e("div",Y,[(r(!0),o(b,null,q(v.value,s=>(r(),o("div",{key:s._id,class:"user-item"},[e("div",Z,[C(F,{src:s.avatar,size:"medium"},null,8,["src"])]),e("div",I,[e("div",ss,d(s.nickname||s.username),1),e("div",es,"@"+d(s.username),1)]),e("div",ts,[!s.isFriend&&!s.requestSent?(r(),o("button",{key:0,class:"add-btn",onClick:n=>w(s._id),disabled:s.requesting},d(s.requesting?"发送中...":"添加"),9,as)):s.isFriend?(r(),o("span",ns,"已是好友")):s.requestSent?(r(),o("span",is,"请求已发送")):p("",!0)])]))),128))])])):p("",!0),!_.value&&f.value.length>0?(r(),o("div",os,[t[6]||(t[6]=e("h3",null,"推荐好友",-1)),e("div",rs,[(r(!0),o(b,null,q(f.value,s=>(r(),o("div",{key:s._id,class:"user-item"},[e("div",cs,[C(F,{src:s.avatar,size:"medium"},null,8,["src"])]),e("div",ds,[e("div",ls,d(s.nickname||s.username),1),e("div",us,"@"+d(s.username),1)]),e("div",vs,[!s.isFriend&&!s.requestSent?(r(),o("button",{key:0,class:"add-btn",onClick:n=>w(s._id),disabled:s.requesting},d(s.requesting?"发送中...":"添加"),9,_s)):s.isFriend?(r(),o("span",ps,"已是好友")):s.requestSent?(r(),o("span",ms,"请求已发送")):p("",!0)])]))),128))])])):p("",!0),c.value.length>0?(r(),o("div",fs,[e("h3",null,"好友请求 ("+d(c.value.length)+")",1),e("div",hs,[(r(!0),o(b,null,q(c.value,s=>(r(),o("div",{key:s._id,class:"user-item"},[e("div",gs,[C(F,{src:s.sender.avatar,size:"medium"},null,8,["src"])]),e("div",ys,[e("div",ks,d(s.sender.nickname||s.sender.username),1),e("div",bs,"@"+d(s.sender.username),1),e("div",qs,d(s.message||"请求添加您为好友"),1)]),e("div",Cs,[e("button",{class:"accept-btn",onClick:n=>A(s._id),disabled:s.processing},d(s.processing?"处理中...":"接受"),9,Fs),e("button",{class:"reject-btn",onClick:n=>U(s._id),disabled:s.processing},d(s.processing?"处理中...":"拒绝"),9,xs)])]))),128))])])):p("",!0),_.value&&!m.value&&v.value.length===0?(r(),o("div",ws,t[7]||(t[7]=[e("div",{class:"empty-icon"},[e("i",{class:"iconfont icon-search"})],-1),e("p",null,"未找到匹配的用户",-1),e("p",{class:"search-tip"},"尝试搜索用户名或昵称",-1)]))):p("",!0),!_.value&&v.value.length===0&&f.value.length===0&&c.value.length===0?(r(),o("div",Ss,t[8]||(t[8]=[e("div",{class:"empty-icon"},[e("i",{class:"iconfont icon-user"})],-1),e("p",null,"搜索用户添加好友",-1)]))):p("",!0)])]))}},Ks=N(Rs,[["__scopeId","data-v-69b5e4d2"]]);export{Ks as default};
